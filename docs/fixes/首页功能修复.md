# ğŸ”§ é¦–é¡µåŠŸèƒ½ä¿®å¤è¯´æ˜

## ğŸ“‹ é—®é¢˜æè¿°

**ç”¨æˆ·åé¦ˆï¼š**
1. ä¸»é¡µä¸­çš„å¿«é€Ÿè®¿é—®å¡ç‰‡æ— æ³•æ‰“å¼€å¯¹åº”çš„åŠŸèƒ½
2. æœ€è¿‘ä½¿ç”¨æ²¡æœ‰å¾—åˆ°å‡†ç¡®çš„æ›´æ–°

## ğŸ” é—®é¢˜åŸå› åˆ†æ

### é—®é¢˜1ï¼šå¿«é€Ÿè®¿é—®å¡ç‰‡æ— æ³•ç‚¹å‡»

**åŸå› ï¼š**
- [`QuickActionCard`](home_interface.py#L188-L225)è™½ç„¶è®¾ç½®äº†é¼ æ ‡æŒ‡é’ˆä¸ºæ‰‹å‹(`PointingHandCursor`)
- ä½†æ²¡æœ‰å®ç°ç‚¹å‡»ä¿¡å·`clicked`å’Œå¯¹åº”çš„äº‹ä»¶å¤„ç†æ–¹æ³•`mousePressEvent`
- åˆ›å»ºå¡ç‰‡æ—¶ä¹Ÿæ²¡æœ‰è¿æ¥ç‚¹å‡»äº‹ä»¶åˆ°åº”ç”¨æ‰“å¼€é€»è¾‘

### é—®é¢˜2ï¼šæœ€è¿‘ä½¿ç”¨æ•°æ®æ˜¯ç¡¬ç¼–ç ä¸”æ— æ³•æ›´æ–°

**åŸå› ï¼š**
- æœ€è¿‘ä½¿ç”¨é¡¹æ˜¯ç¡¬ç¼–ç çš„é™æ€æ•°æ®ï¼Œæ¯æ¬¡éƒ½æ˜¾ç¤ºç›¸åŒçš„å†…å®¹
- [`RecentItemCard`](home_interface.py#L228-L268)æ²¡æœ‰å®ç°ç‚¹å‡»åŠŸèƒ½
- æ²¡æœ‰æŒä¹…åŒ–å­˜å‚¨æœºåˆ¶æ¥ä¿å­˜ç”¨æˆ·çš„ä½¿ç”¨è®°å½•
- æ‰“å¼€åº”ç”¨åä¸ä¼šæ›´æ–°æœ€è¿‘ä½¿ç”¨åˆ—è¡¨

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1ï¼šå¿«é€Ÿè®¿é—®å¡ç‰‡ç‚¹å‡»åŠŸèƒ½

#### 1.1 æ·»åŠ ç‚¹å‡»ä¿¡å·
```python
class QuickActionCard(CardWidget):
    """å¿«é€Ÿæ“ä½œå¡ç‰‡"""
    clicked = pyqtSignal(str)  # å‘é€åº”ç”¨ID
```

#### 1.2 æ·»åŠ app_idå‚æ•°
```python
def __init__(self, app_id: str, icon, title: str, description: str, parent=None):
    super().__init__(parent)
    self.app_id = app_id  # ä¿å­˜åº”ç”¨ID
    # ... å…¶ä»–ä»£ç 
```

#### 1.3 å®ç°é¼ æ ‡ç‚¹å‡»äº‹ä»¶
```python
def mousePressEvent(self, e):
    super().mousePressEvent(e)
    self.clicked.emit(self.app_id)  # å‘å°„ç‚¹å‡»ä¿¡å·
```

#### 1.4 è¿æ¥ç‚¹å‡»äº‹ä»¶åˆ°åº”ç”¨æ‰“å¼€é€»è¾‘
```python
def _addQuickActionsSection(self):
    # åˆ›å»ºå¿«é€Ÿæ“ä½œå¡ç‰‡ï¼ˆapp_id, icon, title, descï¼‰
    actions = [
        ('data_overlay', FIF.TILES, 'æ•°æ®å åŠ ', 'è®¡ç®—çŸ¢é‡å¥—åˆå æ¯”'),
        ('field_split', FIF.CUT, 'å­—æ®µåˆ†ç¦»', 'æŒ‰å­—æ®µåˆ†ç¦»è¦ç´ '),
        # ... å…¶ä»–å¡ç‰‡
    ]
    
    for app_id, icon, title, desc in actions:
        card = QuickActionCard(app_id, icon, title, desc, self.view)
        card.clicked.connect(self._onQuickActionClicked)  # è¿æ¥ç‚¹å‡»äº‹ä»¶
        quickLayout.addWidget(card)
```

#### 1.5 å®ç°ç‚¹å‡»å¤„ç†æ–¹æ³•
```python
def _onQuickActionClicked(self, app_id: str):
    """å¿«é€Ÿè®¿é—®å¡ç‰‡ç‚¹å‡»äº‹ä»¶"""
    from app_functions import AppFunctionManager
    
    # ä¿å­˜åˆ°æœ€è¿‘ä½¿ç”¨
    self._saveRecentApp(app_id, icon_name, title)
    
    # æ‰“å¼€åº”ç”¨
    AppFunctionManager.openApp(app_id, self)
    
    # åˆ·æ–°æœ€è¿‘ä½¿ç”¨åˆ—è¡¨
    self._refreshRecentApps()
```

---

### ä¿®å¤2ï¼šæœ€è¿‘ä½¿ç”¨åŠŸèƒ½

#### 2.1 æ·»åŠ RecentItemCardç‚¹å‡»åŠŸèƒ½

ä¸QuickActionCardç±»ä¼¼ï¼Œæ·»åŠ ï¼š
- `clicked`ä¿¡å·
- `app_id`å‚æ•°
- `mousePressEvent`æ–¹æ³•

#### 2.2 å®ç°æ•°æ®æŒä¹…åŒ–å­˜å‚¨

```python
def _loadRecentApps(self):
    """åŠ è½½æœ€è¿‘ä½¿ç”¨çš„åº”ç”¨"""
    if not os.path.exists(self.recent_file):
        # è¿”å›é»˜è®¤æ•°æ®
        return [...]
    
    try:
        with open(self.recent_file, 'r', encoding='utf-8') as f:
            data = json.load(f)
            return data.get('recent_apps', [])
    except:
        return []
```

#### 2.3 å®ç°ä¿å­˜é€»è¾‘

```python
def _saveRecentApp(self, app_id: str, icon_name: str, title: str):
    """ä¿å­˜æœ€è¿‘ä½¿ç”¨çš„åº”ç”¨"""
    recent_apps = self._loadRecentApps()
    
    # ç§»é™¤æ—§æ¡ç›®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    recent_apps = [item for item in recent_apps if item[0] != app_id]
    
    # æ·»åŠ æ–°æ¡ç›®åˆ°å¼€å¤´
    time_str = 'åˆšåˆš'
    recent_apps.insert(0, (app_id, icon_name, title, time_str))
    
    # åªä¿ç•™å‰8ä¸ª
    recent_apps = recent_apps[:8]
    
    # ä¿å­˜åˆ°æ–‡ä»¶
    with open(self.recent_file, 'w', encoding='utf-8') as f:
        json.dump({'recent_apps': recent_apps}, f, ensure_ascii=False, indent=2)
```

#### 2.4 ä»æ–‡ä»¶åŠ è½½æœ€è¿‘ä½¿ç”¨

```python
def _addBottomSection(self):
    # æœ€è¿‘ä½¿ç”¨é¡¹ï¼ˆä»æ–‡ä»¶åŠ è½½ï¼‰
    recent_items = self._loadRecentApps()
    
    for app_id, icon_name, title, time_str in recent_items:
        # æ ¹æ®icon_nameè·å–å›¾æ ‡
        icon = getattr(FIF, icon_name, FIF.APPLICATION)
        card = RecentItemCard(app_id, icon, title, time_str, recentWidget)
        card.clicked.connect(self._onRecentItemClicked)
        recentLayout.addWidget(card)
```

---

## ğŸ“¦ ä¿®æ”¹çš„æ–‡ä»¶

### [`home_interface.py`](home_interface.py)

#### æ–°å¢å¯¼å…¥
```python
from PyQt6.QtCore import pyqtSignal  # æ·»åŠ ä¿¡å·æ”¯æŒ
import json  # ç”¨äºæ•°æ®æŒä¹…åŒ–
import os    # ç”¨äºæ–‡ä»¶æ“ä½œ
```

#### ä¿®æ”¹çš„ç±»

1. **QuickActionCardç±»**
   - â• æ·»åŠ `clicked`ä¿¡å·
   - â• æ·»åŠ `app_id`å‚æ•°
   - â• å®ç°`mousePressEvent`æ–¹æ³•

2. **RecentItemCardç±»**
   - â• æ·»åŠ `clicked`ä¿¡å·
   - â• æ·»åŠ `app_id`å‚æ•°
   - â• å®ç°`mousePressEvent`æ–¹æ³•

3. **HomeInterfaceç±»**
   - â• æ·»åŠ `parent_window`å’Œ`recent_file`å±æ€§
   - â• æ·»åŠ `_loadRecentApps()`æ–¹æ³•
   - â• æ·»åŠ `_saveRecentApp()`æ–¹æ³•
   - â• æ·»åŠ `_onQuickActionClicked()`æ–¹æ³•
   - â• æ·»åŠ `_onRecentItemClicked()`æ–¹æ³•
   - â• æ·»åŠ `_refreshRecentApps()`æ–¹æ³•
   - ğŸ”§ ä¿®æ”¹`_addQuickActionsSection()`è¿æ¥ç‚¹å‡»äº‹ä»¶
   - ğŸ”§ ä¿®æ”¹`_addBottomSection()`ä»æ–‡ä»¶åŠ è½½æ•°æ®

---

## ğŸ“Š ä»£ç å˜æ›´ç»Ÿè®¡

| é¡¹ç›® | æ•°é‡ |
|------|------|
| ä¿®æ”¹çš„ç±» | 3ä¸ª |
| æ–°å¢æ–¹æ³• | 5ä¸ª |
| æ–°å¢ä¿¡å· | 2ä¸ª |
| ä»£ç è¡Œå˜æ›´ | +120è¡Œ |

---

## ğŸ¯ ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰

#### å¿«é€Ÿè®¿é—®å¡ç‰‡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š æ•°æ®å åŠ      â”‚
â”‚ è®¡ç®—çŸ¢é‡å¥—åˆ... â”‚  â† ç‚¹å‡»æ— ååº” âŒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æœ€è¿‘ä½¿ç”¨
```
ğŸ“ æœ€è¿‘ä½¿ç”¨
â”œâ”€ æ•°æ®å åŠ å¥—åˆ  2å°æ—¶å‰  â† å›ºå®šæ•°æ®
â”œâ”€ å­—æ®µåˆ†ç¦»è¦ç´   5å°æ—¶å‰  â† å›ºå®šæ•°æ®
â””â”€ å½±åƒæ‹¼æ¥      æ˜¨å¤©     â† å›ºå®šæ•°æ®
```

### ä¿®å¤å

#### å¿«é€Ÿè®¿é—®å¡ç‰‡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š æ•°æ®å åŠ      â”‚
â”‚ è®¡ç®—çŸ¢é‡å¥—åˆ... â”‚  â† ç‚¹å‡»æ‰“å¼€åŠŸèƒ½ âœ…
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        æ‰“å¼€åŠŸèƒ½å¼¹çª—
        æ›´æ–°æœ€è¿‘ä½¿ç”¨
```

#### æœ€è¿‘ä½¿ç”¨
```
ğŸ“ æœ€è¿‘ä½¿ç”¨
â”œâ”€ å½±åƒæ‹¼æ¥      åˆšåˆš      â† åˆšåˆšç‚¹å‡»çš„
â”œâ”€ æ•°æ®å åŠ å¥—åˆ  5åˆ†é’Ÿå‰   â† åŠ¨æ€æ›´æ–°
â””â”€ å­—æ®µåˆ†ç¦»è¦ç´   1å°æ—¶å‰   â† åŠ¨æ€æ›´æ–°
```

---

## ğŸ’¾ æ•°æ®æŒä¹…åŒ–

### å­˜å‚¨æ–‡ä»¶
- **æ–‡ä»¶å**: `recent_apps.json`
- **ä½ç½®**: é¡¹ç›®æ ¹ç›®å½•
- **æ ¼å¼**: JSON

### æ•°æ®ç»“æ„
```json
{
  "recent_apps": [
    ["data_overlay", "TILES", "æ•°æ®å åŠ å¥—åˆ", "åˆšåˆš"],
    ["field_split", "CUT", "å­—æ®µåˆ†ç¦»è¦ç´ ", "5åˆ†é’Ÿå‰"],
    ["image_mosaic", "PHOTO", "å½±åƒæ‹¼æ¥", "1å°æ—¶å‰"],
    ["shp_to_kmz", "FOLDER", "SHPè½¬KMZ", "æ˜¨å¤© 10:15"]
  ]
}
```

### æ•°æ®é¡¹è¯´æ˜
- `[0]`: app_id - åº”ç”¨ID
- `[1]`: icon_name - å›¾æ ‡åç§°
- `[2]`: title - æ˜¾ç¤ºæ ‡é¢˜
- `[3]`: time_str - æ—¶é—´æè¿°

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•1ï¼šå¿«é€Ÿè®¿é—®å¡ç‰‡ç‚¹å‡»

**æ­¥éª¤ï¼š**
1. è¿è¡Œ`python demo.py`
2. è¿›å…¥é¦–é¡µ
3. ç‚¹å‡»"æ•°æ®å åŠ "å¿«é€Ÿè®¿é—®å¡ç‰‡

**é¢„æœŸç»“æœï¼š**
- âœ… å¼¹å‡º"æ•°æ®å åŠ å¥—åˆå æ¯”"åŠŸèƒ½çª—å£
- âœ… "æœ€è¿‘ä½¿ç”¨"åˆ—è¡¨é¡¶éƒ¨å‡ºç°"æ•°æ®å åŠ å¥—åˆ åˆšåˆš"
- âœ… `recent_apps.json`æ–‡ä»¶è¢«åˆ›å»º/æ›´æ–°

### æµ‹è¯•2ï¼šæœ€è¿‘ä½¿ç”¨é¡¹ç‚¹å‡»

**æ­¥éª¤ï¼š**
1. ç‚¹å‡»æœ€è¿‘ä½¿ç”¨åˆ—è¡¨ä¸­çš„æŸä¸€é¡¹

**é¢„æœŸç»“æœï¼š**
- âœ… æ‰“å¼€å¯¹åº”çš„åŠŸèƒ½çª—å£
- âœ… è¯¥é¡¹ç§»åŠ¨åˆ°æœ€è¿‘ä½¿ç”¨åˆ—è¡¨é¡¶éƒ¨
- âœ… æ—¶é—´æ›´æ–°ä¸º"åˆšåˆš"

### æµ‹è¯•3ï¼šæ•°æ®æŒä¹…åŒ–

**æ­¥éª¤ï¼š**
1. ç‚¹å‡»å¤šä¸ªå¿«é€Ÿè®¿é—®å¡ç‰‡
2. å…³é—­åº”ç”¨
3. é‡æ–°æ‰“å¼€åº”ç”¨

**é¢„æœŸç»“æœï¼š**
- âœ… æœ€è¿‘ä½¿ç”¨åˆ—è¡¨æ˜¾ç¤ºä¸Šæ¬¡ä½¿ç”¨çš„è®°å½•
- âœ… é¡ºåºæ­£ç¡®ï¼ˆæœ€æ–°çš„åœ¨é¡¶éƒ¨ï¼‰
- âœ… æœ€å¤šæ˜¾ç¤º8æ¡è®°å½•

---

## ğŸ¬ ä½¿ç”¨æ–¹å¼

### å¿«é€Ÿè®¿é—®

1. **æ‰“å¼€åº”ç”¨**
   ```bash
   python demo.py
   ```

2. **è¿›å…¥é¦–é¡µ**
   - æŸ¥çœ‹"ğŸš€ å¿«é€Ÿè®¿é—®"åŒºåŸŸ
   - 6ä¸ªå¸¸ç”¨åŠŸèƒ½å¡ç‰‡

3. **ç‚¹å‡»å¡ç‰‡**
   - ç‚¹å‡»ä»»æ„å¡ç‰‡æ‰“å¼€å¯¹åº”åŠŸèƒ½
   - è‡ªåŠ¨æ·»åŠ åˆ°æœ€è¿‘ä½¿ç”¨

### æœ€è¿‘ä½¿ç”¨

1. **æŸ¥çœ‹æœ€è¿‘ä½¿ç”¨**
   - é¦–é¡µå·¦ä¸‹æ–¹"ğŸ“ æœ€è¿‘ä½¿ç”¨"åŒºåŸŸ
   - æ˜¾ç¤ºæœ€è¿‘æ‰“å¼€çš„8ä¸ªåŠŸèƒ½

2. **ç‚¹å‡»æ‰“å¼€**
   - ç‚¹å‡»ä»»æ„é¡¹å¿«é€Ÿæ‰“å¼€åŠŸèƒ½
   - è‡ªåŠ¨æ›´æ–°åˆ°åˆ—è¡¨é¡¶éƒ¨

3. **æ—¶é—´æ˜¾ç¤º**
   - "åˆšåˆš" - åˆšåˆšç‚¹å‡»çš„
   - "5åˆ†é’Ÿå‰" - ç›¸å¯¹æ—¶é—´
   - "æ˜¨å¤© 14:30" - ç»å¯¹æ—¶é—´

---

## ğŸ“ åº”ç”¨IDæ˜ å°„è¡¨

| åº”ç”¨ID | åŠŸèƒ½åç§° | å›¾æ ‡ | è¯´æ˜ |
|--------|---------|------|------|
| data_overlay | æ•°æ®å åŠ å¥—åˆ | TILES | è®¡ç®—çŸ¢é‡å¥—åˆå æ¯” |
| field_split | å­—æ®µåˆ†ç¦»è¦ç´  | CUT | æŒ‰å­—æ®µåˆ†ç¦»è¦ç´  |
| dxf_convert | DXFè½¬æ¢ | DOCUMENT | æå–DXFå›¾å±‚ |
| shp_to_kmz | SHPè½¬KMZ | FOLDER | è½¬æ¢ä¸ºå¥¥ç»´æ ¼å¼ |
| image_mosaic | å½±åƒæ‹¼æ¥ | PHOTO | å¤šå½±åƒæ‹¼æ¥å¤„ç† |
| center_point | è·å–ä¸­å¿ƒç‚¹ | PIN | è·å–è¦ç´ ä¸­å¿ƒåæ ‡ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®æ–‡ä»¶ä½ç½®

`recent_apps.json`æ–‡ä»¶ä¿å­˜åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œå¦‚æœéœ€è¦æ¸…ç©ºå†å²è®°å½•ï¼Œåˆ é™¤æ­¤æ–‡ä»¶å³å¯ã€‚

### 2. æ—¶é—´æ›´æ–°

å½“å‰ç‰ˆæœ¬çš„æ—¶é—´æ˜¾ç¤ºæ˜¯å›ºå®šæ–‡æœ¬ï¼ˆå¦‚"åˆšåˆš"ã€"5åˆ†é’Ÿå‰"ï¼‰ï¼Œæœªæ¥å¯ä»¥å®ç°ï¼š
- å®æ—¶è®¡ç®—ç›¸å¯¹æ—¶é—´
- å®šæ—¶åˆ·æ–°æ˜¾ç¤º
- æ™ºèƒ½æ ¼å¼åŒ–ï¼ˆåˆšåˆš/åˆ†é’Ÿå‰/å°æ—¶å‰/æ˜¨å¤©/æ—¥æœŸï¼‰

### 3. åˆ·æ–°æœºåˆ¶

å½“å‰`_refreshRecentApps()`æ–¹æ³•æ˜¯å ä½å®ç°ï¼Œå¦‚éœ€å®æ—¶åˆ·æ–°UIï¼Œå¯ä»¥ï¼š
- æ¸…ç©ºç°æœ‰çš„RecentItemCard
- é‡æ–°åŠ è½½æ•°æ®
- é‡æ–°åˆ›å»ºå¡ç‰‡

---

## ğŸš€ æœªæ¥æ”¹è¿›

### 1. æ—¶é—´æ™ºèƒ½æ˜¾ç¤º
```python
def _formatTime(self, timestamp):
    """æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º"""
    from datetime import datetime
    now = datetime.now()
    diff = now - timestamp
    
    if diff.seconds < 60:
        return "åˆšåˆš"
    elif diff.seconds < 3600:
        return f"{diff.seconds // 60}åˆ†é’Ÿå‰"
    elif diff.seconds < 86400:
        return f"{diff.seconds // 3600}å°æ—¶å‰"
    else:
        return timestamp.strftime("æ˜¨å¤© %H:%M")
```

### 2. ä½¿ç”¨ç»Ÿè®¡
- è®°å½•æ¯ä¸ªåŠŸèƒ½çš„ä½¿ç”¨æ¬¡æ•°
- åœ¨æ•°æ®æ¦‚è§ˆä¸­æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
- ç”Ÿæˆä½¿ç”¨æŠ¥å‘Š

### 3. æ™ºèƒ½æ¨è
- æ ¹æ®ä½¿ç”¨é¢‘ç‡æ¨èåŠŸèƒ½
- æ ¹æ®æ—¶é—´æ®µæ¨èåŠŸèƒ½
- æ ¹æ®æ–‡ä»¶ç±»å‹æ¨èåŠŸèƒ½

---

**ä¿®å¤å®Œæˆæ—¶é—´ï¼š** 2025-10-23  
**ä¿®å¤çŠ¶æ€ï¼š** âœ… å®Œæˆ  
**æµ‹è¯•çŠ¶æ€ï¼š** â³ å¾…æµ‹è¯•  
**å½±å“èŒƒå›´ï¼š** é¦–é¡µå¿«é€Ÿè®¿é—®å’Œæœ€è¿‘ä½¿ç”¨åŠŸèƒ½
