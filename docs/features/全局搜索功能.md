# 🔍 知秋工作平台 - 全局搜索功能说明

## ✨ 功能概述

全局搜索功能允许您在应用的任何页面快速搜索并启动应用和工具，无需切换到应用页面。搜索结果以下拉列表的形式实时展示在搜索框下方。

---

## 🎯 核心特性

### 1️⃣ **全局可用**
- ✅ 在首页搜索
- ✅ 在应用页面搜索
- ✅ 在视频页面搜索
- ✅ 在库页面搜索
- ✅ 在设置页面搜索
- ✅ **任何页面都可以使用！**

### 2️⃣ **实时搜索**
- ✅ 输入即搜索，无需点击按钮
- ✅ 智能匹配应用名称和描述
- ✅ 支持中文、拼音、关键词搜索
- ✅ 最多显示 6 个匹配结果

### 3️⃣ **下拉展示**
- ✅ 搜索框下方弹出下拉列表
- ✅ 卡片式结果展示
- ✅ 包含图标、标题、描述
- ✅ 悬停高亮效果

### 4️⃣ **快速启动**
- ✅ 点击结果直接启动应用
- ✅ 自动关闭下拉框
- ✅ 清空搜索内容
- ✅ 显示启动提示

---

## 📖 使用方法

### 基本搜索

1. **定位搜索框**
   - 在标题栏中间找到搜索框
   - 提示文字：「搜索应用、工具等」

2. **输入关键词**
   ```
   示例搜索词：
   - "数据"     → 找到所有数据相关工具
   - "影像"     → 找到影像拼接、影像裁剪
   - "转换"     → 找到各类格式转换工具
   - "坐标"     → 找到坐标转SHP
   - "PDF"      → 找到PDF工具
   ```

3. **查看结果**
   - 下拉列表自动展开
   - 显示匹配的应用
   - 每项包含：
     - 🎨 应用图标
     - 📝 应用名称
     - 💬 功能描述

4. **选择应用**
   - 点击任意搜索结果
   - 应用自动启动
   - 搜索框自动清空

---

## 🎨 界面展示

### 搜索框位置
```
┌─────────────────────────────────────────────┐
│  知秋工作平台  [  搜索应用、工具等...  ]  🔔⚙️👤│
└─────────────────────────────────────────────┘
```

### 下拉结果示例
```
┌─────────────────────────────────────┐
│  🔍 搜索：影像                      │
├─────────────────────────────────────┤
│  📷  影像拼接                        │
│      多影像文件拼接处理              │
├─────────────────────────────────────┤
│  ✂️  影像裁剪                        │
│      根据矢量裁剪影像                │
└─────────────────────────────────────┘
```

---

## 🔧 技术实现

### 核心组件

#### 1. GlobalSearchDropdown
```python
- 全局搜索下拉框主组件
- 弹出式窗口设计
- 支持动态结果更新
- 卡片式结果展示
```

#### 2. SearchResultItem
```python
- 单个搜索结果项
- 图标 + 标题 + 描述布局
- 悬停高亮效果
- 点击启动功能
```

#### 3. CustomTitleBar 集成
```python
- 集成搜索下拉框
- 实时监听输入变化
- 控制下拉框显示/隐藏
- 处理应用启动
```

### 搜索逻辑

```python
def updateResults(keyword):
    # 1. 清空现有结果
    # 2. 遍历所有应用数据
    # 3. 匹配标题和描述
    # 4. 显示前6个结果
    # 5. 无结果显示提示
```

### 匹配算法

```python
# 简单包含匹配
if keyword in title.lower() or keyword in desc.lower():
    # 添加到匹配结果
```

---

## 📊 支持的应用列表

当前支持搜索以下 16 个应用：

| 应用名称 | 关键词 | 功能描述 |
|---------|--------|---------|
| 数据叠加套合 | 数据、叠加、套合 | 计算矢量套合占比 |
| 字段分离要素 | 字段、分离 | 按字段分离要素 |
| 面积调整要素 | 面积、调整、缓冲 | 根据面积缓冲调整 |
| 投影转换 | 投影、转换 | 修改定义投影 |
| DXF转SHP | DXF、转换 | 提取DXF图层 |
| 合并要素 | 合并 | 合并所有要素 |
| 挂接表格 | 挂接、表格 | 挂接表格信息 |
| 表格比对 | 表格、比对 | 差异化比对分析 |
| SHP转KMZ | KMZ、奥维 | 转换为奥维格式 |
| SHP转WKT | WKT、文本 | 转换为WKT格式 |
| PDF工具 | PDF | PDF合并分离转换 |
| 影像拼接 | 影像、拼接 | 多影像拼接处理 |
| 获取中心点 | 中心点、坐标 | 获取要素中心坐标 |
| 影像裁剪 | 影像、裁剪 | 根据矢量裁剪影像 |
| 坡度统计 | 坡度、统计 | 坡度面积统计 |
| 坐标转SHP | 坐标、转换 | 坐标点转矢量 |

---

## 💡 使用技巧

### 1. 模糊搜索
```
输入部分关键词即可：
- "影" → 找到影像拼接、影像裁剪
- "转" → 找到所有转换工具
- "数据" → 找到数据相关工具
```

### 2. 描述搜索
```
搜索功能描述也能匹配：
- "矢量" → 匹配描述中含"矢量"的工具
- "文件" → 匹配处理文件的工具
- "坐标" → 匹配坐标相关功能
```

### 3. 快捷操作
```
- ESC 键：关闭下拉框
- 点击空白处：关闭下拉框
- 清空搜索：自动关闭下拉框
```

### 4. 键盘导航
```
当前版本：点击选择
未来版本：支持上下键选择 + 回车确认
```

---

## 🎨 视觉效果

### 主题适配
- ✅ **浅色模式**：白色背景 + 主题色边框
- ✅ **深色模式**：深色背景 + 主题色边框
- ✅ 自动跟随系统主题

### 悬停效果
```
默认状态：
- 边框：淡色
- 背景：透明

悬停状态：
- 边框：主题色
- 背景：主题色5%透明度
```

### 动画效果
- ✅ 下拉框平滑展开
- ✅ 结果项淡入显示
- ✅ 悬停平滑过渡

---

## 📝 代码结构

```
知秋工作平台/
├── global_search.py          # 全局搜索组件 ⭐ 新增
│   ├── SearchResultItem      # 搜索结果项
│   └── GlobalSearchDropdown  # 搜索下拉框
├── demo.py                   # 主程序
│   └── CustomTitleBar        # 集成全局搜索 ✅ 修改
└── app_card_interface.py     # 应用卡片界面
```

---

## 🔄 与应用页面的关系

### 保留原有功能
- ✅ 应用页面的过滤功能仍然保留
- ✅ 在应用页面搜索时，同时：
  - 显示全局搜索下拉框
  - 过滤应用页面卡片

### 功能互补
```
全局搜索：快速启动任意应用
应用页面：浏览所有应用详情
```

---

## ⚙️ 自定义配置

### 修改最大结果数
```python
# global_search.py 第 130 行
for app_id, icon, title, desc in matched_apps[:6]:  # 改为其他数字
```

### 调整下拉框宽度
```python
# 自动使用搜索框宽度
self.searchDropdown.showAtPosition(pos, self.searchLineEdit.width())
```

### 修改结果项高度
```python
# global_search.py 第 17 行
self.setFixedHeight(70)  # 修改高度值
```

### 添加新应用数据
```python
# global_search.py 第 87 行
self.apps_data = [
    ('new_app', FIF.ICON, '应用名称', '功能描述'),
    # 添加更多...
]
```

---

## 🚀 未来优化方向

### 计划功能
- [ ] 键盘导航（上下键选择）
- [ ] 搜索历史记录
- [ ] 拼音首字母搜索
- [ ] 模糊匹配算法优化
- [ ] 收藏应用功能
- [ ] 使用频率排序
- [ ] 搜索结果分类展示

### 性能优化
- [ ] 结果缓存机制
- [ ] 异步搜索
- [ ] 搜索防抖
- [ ] 虚拟滚动（大量结果）

---

## ❓ 常见问题

### Q1: 搜索不到应用？
**A**: 检查关键词是否正确，尝试输入应用名称的部分内容或功能描述。

### Q2: 下拉框不显示？
**A**: 确保搜索框有输入内容，清空后下拉框会自动隐藏。

### Q3: 点击结果没反应？
**A**: 检查 app_functions.py 中对应的应用ID是否正确配置。

### Q4: 如何关闭下拉框？
**A**: 清空搜索内容、点击空白处，或选择一个结果后自动关闭。

### Q5: 能否在下拉框中显示更多结果？
**A**: 可以修改 `global_search.py` 中的 `matched_apps[:6]` 数字。

---

## 📚 相关文件

- [`global_search.py`](c:\Project\知秋工作平台\global_search.py) - 全局搜索组件源码
- [`demo.py`](c:\Project\知秋工作平台\demo.py) - 主程序集成代码
- [`app_card_interface.py`](c:\Project\知秋工作平台\app_card_interface.py) - 应用数据参考

---

## 🎊 使用示例

### 场景1：快速启动工具
```
1. 在首页，想要使用影像拼接工具
2. 在搜索框输入"影像"
3. 下拉框显示"影像拼接"和"影像裁剪"
4. 点击"影像拼接"
5. 工具启动！
```

### 场景2：查找转换工具
```
1. 在设置页面，需要转换DXF文件
2. 输入"DXF"
3. 下拉框显示"DXF转SHP"
4. 点击启动
```

### 场景3：模糊搜索
```
1. 忘记工具名称，只记得是处理表格的
2. 输入"表格"
3. 显示"挂接表格"和"表格比对"
4. 选择需要的工具
```

---

**知秋工作平台** - 全局搜索，随时启动！🔍✨
