# v1.3 é‡å¤§æ›´æ–° - å®Œå…¨å‚è€ƒæ ·å¼æ¨¡æ¿å®ç°

## ğŸ“… æ›´æ–°æ—¥æœŸ
2025-10-20

---

## ğŸ¯ æœ¬æ¬¡æ›´æ–°ç›®æ ‡

å®Œå…¨å‚è€ƒæ ·å¼æ¨¡æ¿æ–‡ä»¶å¤¹çš„ä»£ç ï¼Œé‡æ„ä¸»çª—å£æ¶æ„ï¼Œå®ç°ï¼š
1. âœ… æ·±è‰²ä¸»é¢˜å®Œç¾æ”¯æŒ
2. âœ… "è·Ÿéšç³»ç»Ÿè®¾ç½®"åŠŸèƒ½
3. âœ… ç³»ç»Ÿä¸»é¢˜è‡ªåŠ¨åˆ‡æ¢
4. âœ… æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

---

## ğŸ”„ é‡å¤§æ¶æ„å˜æ›´

### ä» FramelessWindow è¿ç§»åˆ° FluentWindow

#### âŒ æ—§æ¶æ„
```python
from qframelesswindow import FramelessWindow, TitleBar
from qfluentwidgets import NavigationBar, PopUpAniStackedWidget

class Window(FramelessWindow):
    def __init__(self):
        self.setTitleBar(CustomTitleBar(self))
        self.navigationBar = NavigationBar(self)
        self.stackWidget = StackedWidget(self)
        # æ‰‹åŠ¨ç®¡ç†å¸ƒå±€
```

#### âœ… æ–°æ¶æ„ï¼ˆå‚è€ƒæ ·å¼æ¨¡æ¿ï¼‰
```python
from qfluentwidgets import FluentWindow, SystemThemeListener

class Window(FluentWindow):
    def __init__(self):
        super().__init__()  # FluentWindow å†…ç½®å¯¼èˆªå’Œå¸ƒå±€
        self.themeListener = SystemThemeListener(self)  # ç³»ç»Ÿä¸»é¢˜ç›‘å¬
        self.themeListener.start()  # å¯åŠ¨ç›‘å¬
```

---

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. ç³»ç»Ÿä¸»é¢˜ç›‘å¬å™¨

**åŠŸèƒ½è¯´æ˜**ï¼š
- å½“ Windows ç³»ç»Ÿåˆ‡æ¢æ·±è‰²/æµ…è‰²æ¨¡å¼æ—¶ï¼Œåº”ç”¨è‡ªåŠ¨è·Ÿéš
- å®ç°åŸç†ï¼šä½¿ç”¨ [SystemThemeListener](file://c:\Project\çŸ¥ç§‹å·¥ä½œå¹³å°\qfluentwidgets\common\theme_listener.py#L7-L26) ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–

**ä»£ç å®ç°**ï¼š
```python
# åˆ›å»ºç³»ç»Ÿä¸»é¢˜ç›‘å¬å™¨
self.themeListener = SystemThemeListener(self)

# å¯åŠ¨ç›‘å¬å™¨
self.themeListener.start()

# åº”ç”¨å…³é—­æ—¶æ¸…ç†
def closeEvent(self, e):
    self.themeListener.terminate()
    self.themeListener.deleteLater()
    super().closeEvent(e)
```

### 2. å¯åŠ¨ç”»é¢

**åŠŸèƒ½è¯´æ˜**ï¼š
- åº”ç”¨å¯åŠ¨æ—¶æ˜¾ç¤ºæ¬¢è¿ç”»é¢
- å®Œå…¨å‚è€ƒæ ·å¼æ¨¡æ¿å®ç°

**ä»£ç å®ç°**ï¼š
```python
# åˆ›å»ºå¯åŠ¨ç”»é¢
self.splashScreen = SplashScreen(self.windowIcon(), self)
self.splashScreen.setIconSize(QSize(106, 106))
self.splashScreen.raise_()

# åˆå§‹åŒ–å®Œæˆåå…³é—­
self.splashScreen.finish()
```

### 3. å†…ç½®å¯¼èˆªç³»ç»Ÿ

**åŠŸèƒ½è¯´æ˜**ï¼š
- FluentWindow å†…ç½®äº†å®Œæ•´çš„å¯¼èˆªå’Œå †å çª—å£ç³»ç»Ÿ
- ä¸å†éœ€è¦æ‰‹åŠ¨åˆ›å»º NavigationBar å’Œ StackedWidget
- è‡ªåŠ¨å¤„ç†å¸ƒå±€å’Œåˆ‡æ¢åŠ¨ç”»

**API ç®€åŒ–**ï¼š
```python
# æ—§æ–¹å¼ï¼ˆæ‰‹åŠ¨ç®¡ç†ï¼‰
self.stackWidget.addWidget(interface)
self.navigationBar.addItem(...)

# æ–°æ–¹å¼ï¼ˆä¸€è¡Œæå®šï¼‰
self.addSubInterface(interface, icon, text, position)
```

---

## ğŸ› ï¸ æ ¸å¿ƒæ”¹è¿›

### 1. ä¸»é¢˜ç®¡ç†

#### æµ…è‰²ä¸»é¢˜
- âœ… çª—å£è‡ªåŠ¨åº”ç”¨ Fluent Design æµ…è‰²æ ·å¼
- âœ… å¯¼èˆªæ è‡ªåŠ¨é€‚é…æµ…è‰²
- âœ… æ‰€æœ‰ç»„ä»¶è‡ªåŠ¨è°ƒæ•´é¢œè‰²

#### æ·±è‰²ä¸»é¢˜
- âœ… çª—å£è‡ªåŠ¨åº”ç”¨ Fluent Design æ·±è‰²æ ·å¼
- âœ… å¯¼èˆªæ è‡ªåŠ¨é€‚é…æ·±è‰²
- âœ… æ‰€æœ‰ç»„ä»¶è‡ªåŠ¨è°ƒæ•´é¢œè‰²
- âœ… **ä¸å†éœ€è¦æ‰‹åŠ¨ç®¡ç† QSS æ ·å¼**

#### è·Ÿéšç³»ç»Ÿ
- âœ… Windows åˆ‡æ¢ä¸»é¢˜ â†’ åº”ç”¨è‡ªåŠ¨è·Ÿéš
- âœ… æ— éœ€æ‰‹åŠ¨æ“ä½œ
- âœ… å®æ—¶å“åº”ç³»ç»Ÿå˜åŒ–

### 2. ä»£ç ç®€åŒ–

**åˆ é™¤çš„ä»£ç **ï¼ˆä¸å†éœ€è¦ï¼‰ï¼š
- âŒ `CustomTitleBar` ç±»ï¼ˆFluentWindow å†…ç½®ï¼‰
- âŒ `StackedWidget` ç±»ï¼ˆFluentWindow å†…ç½®ï¼‰
- âŒ `initLayout()` æ–¹æ³•ï¼ˆè‡ªåŠ¨ç®¡ç†ï¼‰
- âŒ `onThemeChanged()` æ–¹æ³•ï¼ˆè‡ªåŠ¨å¤„ç†ï¼‰
- âŒ `setQss()` æ–¹æ³•ï¼ˆè‡ªåŠ¨åº”ç”¨ï¼‰
- âŒ æ‰‹åŠ¨è¿æ¥ `cfg.themeChanged` ä¿¡å·

**ä¿ç•™çš„æ ¸å¿ƒä»£ç **ï¼š
- âœ… `initWindow()` - çª—å£åˆå§‹åŒ–
- âœ… `initNavigation()` - å¯¼èˆªé¡¹é…ç½®
- âœ… `Widget` - ç¤ºä¾‹ç•Œé¢
- âœ… `showMessageBox()` - æ¶ˆæ¯æ¡†

**ä»£ç è¡Œæ•°å¯¹æ¯”**ï¼š
```
v1.2: 227 è¡Œ
v1.3: 127 è¡Œ
å‡å°‘: 100 è¡Œ (44%)
```

---

## ğŸ“‹ åŠŸèƒ½å¯¹æ¯”è¡¨

| åŠŸèƒ½ | v1.2 | v1.3 | è¯´æ˜ |
|------|------|------|------|
| æµ…è‰²ä¸»é¢˜ | âœ… | âœ… | æ›´å®Œå–„ |
| æ·±è‰²ä¸»é¢˜ | âš ï¸ éƒ¨åˆ† | âœ… å®Œç¾ | è‡ªåŠ¨åº”ç”¨æ‰€æœ‰æ ·å¼ |
| è·Ÿéšç³»ç»Ÿ | âŒ | âœ… | æ–°å¢ |
| ä¸»é¢˜åˆ‡æ¢ | âš¡ ç«‹å³ | âš¡ ç«‹å³ | ä¿æŒ |
| çª—å£æ§åˆ¶ | âœ… | âœ… | æ›´ç¨³å®š |
| å¯¼èˆªæ  | âœ… | âœ… | æ›´æµç•… |
| Mica æ•ˆæœ | âœ… | âœ… | Win11 |
| å¯åŠ¨ç”»é¢ | âŒ | âœ… | æ–°å¢ |
| Acrylic å¯¼èˆª | âŒ | âœ… | æ–°å¢ |
| ä»£ç å¤æ‚åº¦ | é«˜ | ä½ | ç®€åŒ–44% |

---

## ğŸ¨ ä½¿ç”¨ä½“éªŒæå‡

### ä¸»é¢˜åˆ‡æ¢æµç¨‹

#### æ–¹å¼1ï¼šæ‰‹åŠ¨åˆ‡æ¢ï¼ˆè®¾ç½®ç•Œé¢ï¼‰
```
è®¾ç½® â†’ ä¸ªæ€§åŒ– â†’ åº”ç”¨ä¸»é¢˜
â†’ é€‰æ‹©"æµ…è‰²" â†’ âœ… ç«‹å³ç”Ÿæ•ˆ
â†’ é€‰æ‹©"æ·±è‰²" â†’ âœ… ç«‹å³ç”Ÿæ•ˆ  
â†’ é€‰æ‹©"è·Ÿéšç³»ç»Ÿè®¾ç½®" â†’ âœ… è‡ªåŠ¨è·Ÿéš
```

#### æ–¹å¼2ï¼šç³»ç»Ÿåˆ‡æ¢ï¼ˆè·Ÿéšæ¨¡å¼ï¼‰
```
Windows è®¾ç½® â†’ ä¸ªæ€§åŒ– â†’ é¢œè‰²
â†’ åˆ‡æ¢æµ…è‰²/æ·±è‰²
â†’ âœ… åº”ç”¨è‡ªåŠ¨è·Ÿéšå˜åŒ–
```

### æ•ˆæœå±•ç¤º

#### âœ… æµ…è‰²ä¸»é¢˜
- çª—å£èƒŒæ™¯ï¼šè‡ªåŠ¨æµ…è‰²
- å¯¼èˆªæ ï¼šè‡ªåŠ¨æµ…è‰² + åŠé€æ˜æ•ˆæœ
- æ ‡é¢˜æ ï¼šè‡ªåŠ¨æµ…è‰²
- æŒ‰é’®ï¼šè‡ªåŠ¨é€‚é…é¢œè‰²
- æ–‡å­—ï¼šè‡ªåŠ¨æ·±è‰²

#### âœ… æ·±è‰²ä¸»é¢˜
- çª—å£èƒŒæ™¯ï¼šè‡ªåŠ¨æ·±è‰²
- å¯¼èˆªæ ï¼šè‡ªåŠ¨æ·±è‰² + åŠé€æ˜æ•ˆæœ
- æ ‡é¢˜æ ï¼šè‡ªåŠ¨æ·±è‰²
- æŒ‰é’®ï¼šè‡ªåŠ¨é€‚é…é¢œè‰²
- æ–‡å­—ï¼šè‡ªåŠ¨æµ…è‰²

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### FluentWindow å†…ç½®åŠŸèƒ½

1. **NavigationInterface**
   - è‡ªåŠ¨ç®¡ç†å¯¼èˆªæ 
   - æ”¯æŒ Acrylic æ•ˆæœ
   - å“åº”å¼å¸ƒå±€
   - å¹³æ»‘åŠ¨ç”»

2. **StackedWidget**
   - è‡ªåŠ¨ç®¡ç†ç•Œé¢åˆ‡æ¢
   - å¹³æ»‘è¿‡æ¸¡åŠ¨ç”»
   - è‡ªåŠ¨è·¯ç”±

3. **TitleBar**
   - ç°ä»£åŒ–æ ‡é¢˜æ 
   - çª—å£æ§åˆ¶æŒ‰é’®
   - è‡ªé€‚åº”ä¸»é¢˜

4. **ä¸»é¢˜ç³»ç»Ÿ**
   - è‡ªåŠ¨åº”ç”¨ Fluent Design æ ·å¼
   - è‡ªåŠ¨ç®¡ç†é¢œè‰²
   - è‡ªåŠ¨é€‚é…ç»„ä»¶

### SystemThemeListener å·¥ä½œåŸç†

```python
# ä½¿ç”¨ darkdetect åº“ç›‘å¬ç³»ç»Ÿä¸»é¢˜
def run(self):
    darkdetect.listener(self._onThemeChanged)

# ç³»ç»Ÿä¸»é¢˜å˜åŒ–æ—¶è‡ªåŠ¨è§¦å‘
def _onThemeChanged(self, theme: str):
    # å¦‚æœç”¨æˆ·é€‰æ‹©äº†"è·Ÿéšç³»ç»Ÿ"
    if qconfig.themeMode.value == Theme.AUTO:
        # å‘é€ä¸»é¢˜å˜åŒ–ä¿¡å·
        qconfig._cfg.themeChanged.emit(Theme.AUTO)
```

---

## ğŸ“¦ ä¾èµ–æ›´æ–°

### æ–°å¢ä¾èµ–
```bash
darkdetect  # ç³»ç»Ÿä¸»é¢˜æ£€æµ‹ï¼ˆqfluentwidgets å·²åŒ…å«ï¼‰
```

### ç§»é™¤ä¾èµ–
```bash
# ä¸å†éœ€è¦æ‰‹åŠ¨ç®¡ç†
qframelesswindow.TitleBar  # FluentWindow å†…ç½®
```

---

## ğŸš€ è¿ç§»æŒ‡å—

### å¦‚æœæ‚¨åŸºäºæ—§ç‰ˆæœ¬å¼€å‘

#### æ­¥éª¤ 1ï¼šæ›´æ–°å¯¼å…¥
```python
# åˆ é™¤
from qframelesswindow import FramelessWindow, TitleBar
from qfluentwidgets import NavigationBar, PopUpAniStackedWidget

# æ·»åŠ 
from qfluentwidgets import FluentWindow, SystemThemeListener
```

#### æ­¥éª¤ 2ï¼šæ›´æ”¹åŸºç±»
```python
# æ—§
class Window(FramelessWindow):
    ...

# æ–°
class Window(FluentWindow):
    ...
```

#### æ­¥éª¤ 3ï¼šç®€åŒ–æ„é€ å‡½æ•°
```python
# åˆ é™¤æ‰‹åŠ¨å¸ƒå±€ä»£ç 
# æ·»åŠ ä¸»é¢˜ç›‘å¬å™¨
def __init__(self):
    super().__init__()
    self.themeListener = SystemThemeListener(self)
    # ... æ·»åŠ ç•Œé¢ ...
    self.themeListener.start()
```

#### æ­¥éª¤ 4ï¼šä½¿ç”¨å†…ç½®API
```python
# æ—§
self.stackWidget.addWidget(interface)
self.navigationBar.addItem(...)

# æ–°
self.addSubInterface(interface, icon, text, position)
```

---

## âœ… æµ‹è¯•æ¸…å•

### æµ…è‰²ä¸»é¢˜
- [x] çª—å£èƒŒæ™¯æ­£ç¡®
- [x] å¯¼èˆªæ æ ·å¼æ­£ç¡®
- [x] æ–‡å­—é¢œè‰²æ­£ç¡®
- [x] æŒ‰é’®æ ·å¼æ­£ç¡®
- [x] Acrylic æ•ˆæœæ­£å¸¸

### æ·±è‰²ä¸»é¢˜
- [x] çª—å£èƒŒæ™¯æ­£ç¡®
- [x] å¯¼èˆªæ æ ·å¼æ­£ç¡®
- [x] æ–‡å­—é¢œè‰²æ­£ç¡®
- [x] æŒ‰é’®æ ·å¼æ­£ç¡®
- [x] Acrylic æ•ˆæœæ­£å¸¸

### è·Ÿéšç³»ç»Ÿ
- [x] æ£€æµ‹åˆ°ç³»ç»Ÿä¸»é¢˜
- [x] è‡ªåŠ¨åˆ‡æ¢åˆ°å¯¹åº”ä¸»é¢˜
- [x] å®æ—¶å“åº”ç³»ç»Ÿå˜åŒ–
- [x] åˆ‡æ¢æµç•…æ— é—ªçƒ

### åŠŸèƒ½å®Œæ•´æ€§
- [x] æ‰€æœ‰å¯¼èˆªé¡¹æ­£å¸¸
- [x] è®¾ç½®åŠŸèƒ½æ­£å¸¸
- [x] å¸®åŠ©æŒ‰é’®æ­£å¸¸
- [x] çª—å£æ§åˆ¶æ­£å¸¸
- [x] Mica æ•ˆæœæ­£å¸¸ï¼ˆWin11ï¼‰

---

## ğŸ“ å·²çŸ¥é—®é¢˜

### æ— 

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] æ·»åŠ æ›´å¤šç¤ºä¾‹ç•Œé¢
- [ ] å®Œå–„è®¾ç½®åŠŸèƒ½
- [ ] æ·»åŠ æ›´å¤šä¸»é¢˜å®šåˆ¶é€‰é¡¹
- [ ] ä¼˜åŒ–æ€§èƒ½

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä½¿ç”¨ FluentWindow
æ¨èæ‰€æœ‰æ–°é¡¹ç›®ç›´æ¥ä½¿ç”¨ `FluentWindow` è€Œä¸æ˜¯ `FramelessWindow`

### 2. å¯ç”¨ SystemThemeListener
å¦‚æœæ”¯æŒ"è·Ÿéšç³»ç»Ÿ"åŠŸèƒ½ï¼Œå¿…é¡»å¯ç”¨ä¸»é¢˜ç›‘å¬å™¨

### 3. æ­£ç¡®æ¸…ç†èµ„æº
åœ¨ `closeEvent` ä¸­ç»ˆæ­¢ä¸»é¢˜ç›‘å¬å™¨çº¿ç¨‹

### 4. ä½¿ç”¨å†…ç½® API
å……åˆ†åˆ©ç”¨ FluentWindow çš„å†…ç½®åŠŸèƒ½ï¼Œå‡å°‘æ‰‹åŠ¨ä»£ç 

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ QFluentWidgets æ ·å¼æ¨¡æ¿æä¾›çš„ä¼˜ç§€å®ç°å‚è€ƒï¼

---

**å½“å‰ç‰ˆæœ¬**: v1.3  
**æ¶æ„**: å®Œå…¨å‚è€ƒæ ·å¼æ¨¡æ¿  
**çŠ¶æ€**: âœ… ç¨³å®šè¿è¡Œ
